var vfs=require("../"),path=require("path"),fs=require("graceful-fs"),bufEqual=require("buffer-equal"),through=require("through2"),File=require("vinyl"),should=require("should");require("mocha");var dataWrap=function(e){return function(t,n,r){e(t);r()}};describe("source stream",function(){it("should pass through writes",function(e){var t=path.join(__dirname,"./fixtures/test.coffee"),n=fs.readFileSync(t),r=new File({base:__dirname,cwd:__dirname,path:t,contents:n}),i=function(){o.length.should.equal(1);o[0].should.equal(r);bufEqual(o[0].contents,n).should.equal(!0);e()},s=vfs.src("./fixtures/nothing.coffee"),o=[];bufferStream=through.obj(dataWrap(o.push.bind(o)),i);s.pipe(bufferStream);s.write(r);s.end()});it("should glob a file with default settings",function(e){var t=path.join(__dirname,"./fixtures/test.coffee"),n=fs.readFileSync(t),r=function(){s.length.should.equal(1);should.exist(s[0].stat);s[0].path.should.equal(t);s[0].isBuffer().should.equal(!0);bufEqual(s[0].contents,n).should.equal(!0);e()},i=vfs.src("./fixtures/*.coffee",{cwd:__dirname}),s=[];bufferStream=through.obj(dataWrap(s.push.bind(s)),r);i.pipe(bufferStream)});it("should glob a file with default settings and relative cwd",function(e){var t=path.join(__dirname,"./fixtures/test.coffee"),n=fs.readFileSync(t),r=function(){s.length.should.equal(1);should.exist(s[0].stat);s[0].path.should.equal(t);s[0].isBuffer().should.equal(!0);bufEqual(s[0].contents,n).should.equal(!0);e()},i=vfs.src("./fixtures/*.coffee",{cwd:path.relative(process.cwd(),__dirname)}),s=[];bufferStream=through.obj(dataWrap(s.push.bind(s)),r);i.pipe(bufferStream)});it("should glob a directory with default settings",function(e){var t=path.join(__dirname,"./fixtures/wow"),n=function(){i.length.should.equal(1);i[0].path.should.equal(t);i[0].isNull().should.equal(!0);i[0].isDirectory().should.equal(!0);e()},r=vfs.src("./fixtures/wow/",{cwd:__dirname}),i=[];bufferStream=through.obj(dataWrap(i.push.bind(i)),n);r.pipe(bufferStream)});it("should glob a file with with no contents",function(e){var t=path.join(__dirname,"./fixtures/test.coffee"),n=fs.readFileSync(t),r=function(){s.length.should.equal(1);s[0].path.should.equal(t);s[0].isNull().should.equal(!0);should.not.exist(s[0].contents);e()},i=vfs.src("./fixtures/*.coffee",{cwd:__dirname,read:!1}),s=[];bufferStream=through.obj(dataWrap(s.push.bind(s)),r);i.pipe(bufferStream)});it("should glob a file with streaming contents",function(e){var t=path.join(__dirname,"./fixtures/test.coffee"),n=fs.readFileSync(t),r=function(){s.length.should.equal(1);should.exist(s[0].stat);s[0].path.should.equal(t);s[0].isStream().should.equal(!0);var r=new Buffer([]),i=through(dataWrap(function(e){r=Buffer.concat([r,e])}));s[0].contents.pipe(i);s[0].contents.once("end",function(){bufEqual(r,n);e()})},i=vfs.src("./fixtures/*.coffee",{cwd:__dirname,buffer:!1}),s=[];bufferStream=through.obj(dataWrap(s.push.bind(s)),r);i.pipe(bufferStream)})});