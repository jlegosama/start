function Reader(e,t){var n=this;if(!(n instanceof Reader))return new Reader(e,t);typeof e=="string"&&(e={path:e});e.path||n.error("Must provide a path",null,!0);var r,i;if(e.type&&typeof e.type=="function"){r=e.type;i=r}else{r=getType(e);i=Reader}if(t&&!r){r=getType(t);e[r]=!0;e.type=r}switch(r){case"Directory":i=DirReader;break;case"Link":case"File":i=FileReader;break;case"SymbolicLink":i=LinkReader;break;case"Socket":i=SocketReader;break;case null:i=ProxyReader}if(!(n instanceof i))return new i(e);Abstract.call(n);n.readable=!0;n.writable=!1;n.type=r;n.props=e;n.depth=e.depth=e.depth||0;n.parent=e.parent||null;n.root=e.root||e.parent&&e.parent.root||n;n._path=n.path=path.resolve(e.path);if(process.platform==="win32"){n.path=n._path=n.path.replace(/\?/g,"_");if(n._path.length>=260){n._swallowErrors=!0;n._path="\\\\?\\"+n.path.replace(/\//g,"\\")}}n.basename=e.basename=path.basename(n.path);n.dirname=e.dirname=path.dirname(n.path);e.parent=e.root=null;n.size=e.size;n.filter=typeof e.filter=="function"?e.filter:null;e.sort==="alpha"&&(e.sort=alphasort);n._stat(t)}function alphasort(e,t){return e===t?0:e.toLowerCase()>t.toLowerCase()?1:e.toLowerCase()<t.toLowerCase()?-1:e>t?1:-1}module.exports=Reader;var fs=require("../../graceful-fs/graceful-fs.js"),Stream=require("stream").Stream,inherits=require("../../inherits/inherits.js"),path=require("path"),getType=require("./get-type.js"),hardLinks=Reader.hardLinks={},Abstract=require("./abstract.js");inherits(Reader,Abstract);var DirReader=require("./dir-reader.js"),FileReader=require("./file-reader.js"),LinkReader=require("./link-reader.js"),SocketReader=require("./socket-reader.js"),ProxyReader=require("./proxy-reader.js");Reader.prototype._stat=function(e){function i(e,r){if(e)return t.error(e);Object.keys(r).forEach(function(e){n[e]=r[e]});if(undefined!==t.size&&n.size!==t.size)return t.error("incorrect size");t.size=n.size;var i=getType(n);if(i!=="Directory"&&n.nlink&&n.nlink>1){var s=n.dev+":"+n.ino;if(hardLinks[s]===t._path||!hardLinks[s])hardLinks[s]=t._path;else{i=t.type=t.props.type="Link";t.Link=t.props.Link=!0;t.linkpath=t.props.linkpath=hardLinks[s];t._stat=t._read=LinkReader.prototype._read}}t.type&&t.type!==i&&t.error("Unexpected type: "+i);if(t.filter){var o=t._proxy||t;if(!t.filter.call(o,o,n)){if(!t._disowned){t.abort();t.emit("end");t.emit("close")}return}}var u=["_stat","stat","ready"],a=0;(function f(){if(t._aborted){t.emit("end");t.emit("close");return}if(t._paused){t.once("resume",f);return}var e=u[a++];if(!e)return t._read();t.emit(e,n);f()})()}var t=this,n=t.props,r=n.follow?"stat":"lstat";e?process.nextTick(i.bind(null,null,e)):fs[r](t._path,i)};Reader.prototype.pipe=function(e,t){var n=this;typeof e.add=="function"&&n.on("entry",function(t){var r=e.add(t);!1===r&&n.pause()});return Stream.prototype.pipe.apply(this,arguments)};Reader.prototype.pause=function(e){this._paused=!0;e=e||this;this.emit("pause",e);this._stream&&this._stream.pause(e)};Reader.prototype.resume=function(e){this._paused=!1;e=e||this;this.emit("resume",e);this._stream&&this._stream.resume(e);this._read()};Reader.prototype._read=function(){this.error("Cannot read unknown type: "+this.type)};