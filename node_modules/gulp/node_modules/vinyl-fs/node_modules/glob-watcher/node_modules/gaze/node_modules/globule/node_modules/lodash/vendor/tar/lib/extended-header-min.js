// An Entry consisting of:
//
// "%d %s=%s\n", <length>, <keyword>, <value>
//
// The length is a decimal number, and includes itself and the \n
// \0 does not terminate anything.  Only the length terminates the string.
// Numeric values are decimal strings.
function ExtendedHeader(){Entry.apply(this,arguments);this.on("data",this._parse);this.fields={};this._position=0;this._fieldPos=0;this._state=SIZE;this._sizeBuf=[];this._keyBuf=[];this._valBuf=[];this._size=-1;this._key=""}function parse(e){if(this._state===ERR)return;for(var t=0,n=e.length;t<n;this._position++,this._fieldPos++,t++){var r=e[t];if(this._size>=0&&this._fieldPos>this._size){error(this,"field exceeds length="+this._size);return}switch(this._state){case ERR:return;case SIZE:if(r===space){this._state=KEY;this._size=parseInt((new Buffer(this._sizeBuf)).toString(),10);this._sizeBuf.length=0;continue}if(r<_0||r>_9){error(this,"expected ["+_0+".."+_9+"], got "+r);return}this._sizeBuf.push(r);continue;case KEY:if(r===eq){this._state=VAL;this._key=(new Buffer(this._keyBuf)).toString();keyTrans[this._key]&&(this._key=keyTrans[this._key]);this._keyBuf.length=0;continue}this._keyBuf.push(r);continue;case VAL:if(this._fieldPos===this._size-1){if(r!==cr){error(this,"expected \\n at end of field");return}var i=(new Buffer(this._valBuf)).toString();numeric[this._key]&&(i=parseFloat(i));this.fields[this._key]=i;this._valBuf.length=0;this._state=SIZE;this._size=-1;this._fieldPos=-1;continue}this._valBuf.push(r);continue}}}function error(e,t){t="invalid header: "+t+"\nposition="+e._position+"\nfield position="+e._fieldPos;e.error(t);e.state=ERR}module.exports=ExtendedHeader;var Entry=require("./entry.js"),inherits=require("../vendor/inherits/inherits.js"),tar=require("../tar.js"),numeric=tar.numeric,keyTrans={"SCHILY.dev":"dev","SCHILY.ino":"ino","SCHILY.nlink":"nlink"};inherits(ExtendedHeader,Entry,{_parse:parse});var s=0,states=ExtendedHeader.states={},SIZE=states.SIZE=s++,KEY=states.KEY=s++,VAL=states.VAL=s++,ERR=states.ERR=s++;Object.keys(states).forEach(function(e){states[states[e]]=states[e]});states[s]=null;var _0="0".charCodeAt(0),_9="9".charCodeAt(0),point=".".charCodeAt(0),a="a".charCodeAt(0),Z="Z".charCodeAt(0),a="a".charCodeAt(0),z="z".charCodeAt(0),space=" ".charCodeAt(0),eq="=".charCodeAt(0),cr="\n".charCodeAt(0);