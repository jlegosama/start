function chownFix(e){return e?function(t,n,r,i){return e.call(fs,t,n,r,function(e,t){chownErOk(e)&&(e=null);i(e,t)})}:e}function chownFixSync(e){return e?function(t,n,r){try{return e.call(fs,t,n,r)}catch(i){if(!chownErOk(i))throw i}}:e}function chownErOk(e){if(!e||(!process.getuid||process.getuid()!==0)&&(e.code==="EINVAL"||e.code==="EPERM"))return!0}var fs=require("fs"),constants=require("constants"),origCwd=process.cwd,cwd=null;process.cwd=function(){cwd||(cwd=origCwd.call(process));return cwd};var chdir=process.chdir;process.chdir=function(e){cwd=null;chdir.call(process,e)};if(constants.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)){fs.lchmod=function(e,t,n){n=n||noop;fs.open(e,constants.O_WRONLY|constants.O_SYMLINK,t,function(e,r){if(e){n(e);return}fs.fchmod(r,t,function(e){fs.close(r,function(t){n(e||t)})})})};fs.lchmodSync=function(e,t){var n=fs.openSync(e,constants.O_WRONLY|constants.O_SYMLINK,t),r,i;try{var s=fs.fchmodSync(n,t)}catch(o){r=o}try{fs.closeSync(n)}catch(o){i=o}if(r||i)throw r||i;return s}}if(!fs.lutimes)if(constants.hasOwnProperty("O_SYMLINK")){fs.lutimes=function(e,t,n,r){fs.open(e,constants.O_SYMLINK,function(e,i){r=r||noop;if(e)return r(e);fs.futimes(i,t,n,function(e){fs.close(i,function(t){return r(e||t)})})})};fs.lutimesSync=function(e,t,n){var r=fs.openSync(e,constants.O_SYMLINK),i,s,o;try{var o=fs.futimesSync(r,t,n)}catch(u){i=u}try{fs.closeSync(r)}catch(u){s=u}if(i||s)throw i||s;return o}}else if(fs.utimensat&&constants.hasOwnProperty("AT_SYMLINK_NOFOLLOW")){fs.lutimes=function(e,t,n,r){fs.utimensat(e,t,n,constants.AT_SYMLINK_NOFOLLOW,r)};fs.lutimesSync=function(e,t,n){return fs.utimensatSync(e,t,n,constants.AT_SYMLINK_NOFOLLOW)}}else{fs.lutimes=function(e,t,n,r){process.nextTick(r)};fs.lutimesSync=function(){}}fs.chown=chownFix(fs.chown);fs.fchown=chownFix(fs.fchown);fs.lchown=chownFix(fs.lchown);fs.chownSync=chownFixSync(fs.chownSync);fs.fchownSync=chownFixSync(fs.fchownSync);fs.lchownSync=chownFixSync(fs.lchownSync);if(!fs.lchmod){fs.lchmod=function(e,t,n){process.nextTick(n)};fs.lchmodSync=function(){}}if(!fs.lchown){fs.lchown=function(e,t,n,r){process.nextTick(r)};fs.lchownSync=function(){}}if(process.platform==="win32"){var rename_=fs.rename;fs.rename=function(t,n,r){var i=Date.now();rename_(t,n,function s(e){if(e&&(e.code==="EACCES"||e.code==="EPERM")&&Date.now()-i<1e3)return rename_(t,n,s);r(e)})}}var read=fs.read;fs.read=function(e,t,n,r,i,s){var o;if(s&&typeof s=="function"){var u=0;o=function(a,f,l){if(a&&a.code==="EAGAIN"&&u<10){u++;return read.call(fs,e,t,n,r,i,o)}s.apply(this,arguments)}}return read.call(fs,e,t,n,r,i,o)};var readSync=fs.readSync;fs.readSync=function(e,t,n,r,i){var s=0;for(;;)try{return readSync.call(fs,e,t,n,r,i)}catch(o){if(o.code==="EAGAIN"&&s<10){s++;continue}throw o}};