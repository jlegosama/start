var expect=require("chai").expect,unique=require(".."),Stream=require("stream"),after=require("after");describe("unique stream",function(){function e(e){var t=new Stream;t.readable=!0;var n=10,r=after(n,function(){setImmediate(function(){t.emit("end")})});for(var i=0;i<n;i++){var s={type:e,name:"name "+i,number:i*10};(function(e){setImmediate(function(){t.emit("data",e);r()})})(s)}return t}it("should be able to uniqueify objects based on JSON data",function(t){var n=unique();e("a").pipe(n);e("a").pipe(n);var r=0;n.on("data",function(){r++}).on("end",function(){expect(r).to.equal(10);t()})});it("should be able to uniqueify objects based on a property",function(t){var n=unique("number");e("a").pipe(n);e("b").pipe(n);var r=0;n.on("data",function(){r++}).on("end",function(){expect(r).to.equal(10);t()})});it("should be able to uniqueify objects based on a function",function(t){var n=unique(function(e){return e.name});e("a").pipe(n);e("b").pipe(n);var r=0;n.on("data",function(){r++}).on("end",function(){expect(r).to.equal(10);t()})});it("should be able to handle uniqueness when not piped",function(e){var t=unique(),n=0;t.on("data",function(e){expect(e).to.equal("hello");n++});t.on("end",function(){expect(n).to.equal(1);e()});t.write("hello");t.write("hello");t.end()})});