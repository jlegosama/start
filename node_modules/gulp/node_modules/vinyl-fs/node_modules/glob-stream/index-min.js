/*jslint node: true */"use strict";var through=require("through"),map=require("map-stream"),Combine=require("ordered-read-streams"),unique=require("unique-stream"),glob=require("glob"),minimatch=require("minimatch"),glob2base=require("glob2base"),path=require("path"),isMatch=function(e,t){return typeof t=="string"?minimatch(e.path,t):t instanceof RegExp?t.test(e.path):!0},isNegative=function(e){return typeof e!="string"?!0:e[0]==="!"?!0:!1},isPositive=function(e){return!isNegative(e)},unrelative=function(e,t){var n="";if(t[0]==="!"){n=t[0];t=t.slice(1)}return n+path.resolve(e,t)},gs={createStream:function(e,t,n){t||(t=[]);n||(n={});typeof n.cwd!="string"&&(n.cwd=process.cwd());typeof n.silent!="boolean"&&(n.silent=!0);typeof n.nonull!="boolean"&&(n.nonull=!1);typeof n.cwdbase!="boolean"&&(n.cwdbase=!1);n.cwdbase&&(n.base=n.cwd);e=unrelative(n.cwd,e);t=t.map(unrelative.bind(null,n.cwd));var r=new glob.Glob(e,n),i=n.base?n.base:glob2base(r),s=through();r.on("error",s.emit.bind(s,"error"));r.on("end",function(){s.end()});r.on("match",function(e){s.write({cwd:n.cwd,base:i,path:path.resolve(n.cwd,e)})});if(t.length===0)return s;var o=map(function(e,n){var r=isMatch.bind(null,e);if(t.every(r))return n(null,e);n()});return s.pipe(o)},create:function(e,t){t||(t={});if(!Array.isArray(e))return gs.createStream(e,null,t);var n=e.filter(isPositive),r=e.filter(isNegative);if(n.length===0)throw new Error("Missing positive glob");if(n.length===1)return gs.createStream(n[0],r,t);var i=n.map(function(e){return gs.createStream(e,r,t)}),s=new Combine(i),o=unique("path");return s.pipe(o)}};module.exports=gs;