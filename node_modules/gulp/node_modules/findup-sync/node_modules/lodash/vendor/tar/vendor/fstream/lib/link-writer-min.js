function LinkWriter(e){var t=this;if(!(t instanceof LinkWriter))throw new Error("LinkWriter must be called as constructor.");if(!(e.type==="Link"&&e.Link||e.type==="SymbolicLink"&&e.SymbolicLink))throw new Error("Non-link type "+e.type);e.linkpath===""&&(e.linkpath=".");e.linkpath||t.error("Need linkpath property to create "+e.type);Writer.call(this,e)}function clobber(e,t,n){rimraf(e._path,function(r){if(r)return e.error(r);create(e,t,n)})}function create(e,t,n){fs[n](t,e._path,function(t){if(t){if(t.code!=="ENOENT"&&t.code!=="EACCES"&&t.code!=="EPERM"||process.platform!=="win32")return e.error(t);e.ready=!0;e.emit("ready");e.emit("end");e.emit("close");e.end=e._finish=function(){}}finish(e)})}function finish(e){e.ready=!0;e.emit("ready");e._ended&&!e._finished&&e._finish()}module.exports=LinkWriter;var fs=require("../../graceful-fs/graceful-fs.js"),Writer=require("./writer.js"),inherits=require("../../inherits/inherits.js"),path=require("path"),rimraf=require("../../rimraf/rimraf.js");inherits(LinkWriter,Writer);LinkWriter.prototype._create=function(){var e=this,t=e.type==="Link"||process.platform==="win32",n=t?"link":"symlink",r=t?path.resolve(e.dirname,e.linkpath):e.linkpath;if(t)return clobber(e,r,n);fs.readlink(e._path,function(t,i){if(i&&i===r)return finish(e);clobber(e,r,n)})};LinkWriter.prototype.end=function(){this._ended=!0;if(this.ready){this._finished=!0;this._finish()}};