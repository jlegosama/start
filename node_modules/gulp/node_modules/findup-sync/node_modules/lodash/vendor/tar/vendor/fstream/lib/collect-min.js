function collect(e){function n(e){typeof e=="string"&&(e=new Buffer(e));if(Buffer.isBuffer(e)&&!e.length)return;t.push(e)}function i(e){collect(e);r.push(e)}function s(e){e.pause()}if(e._collected)return;e._collected=!0;e.pause();e.on("data",n);e.on("end",n);var t=[];e.on("entry",i);var r=[];e.on("proxy",s);e.pipe=function(s){return function(o){function a(){e.removeListener("entry",i);e.removeListener("data",n);e.removeListener("end",n);e.pipe=s;o&&e.pipe(o);t.forEach(function(t){t?e.emit("data",t):e.emit("end")});e.resume()}var u=0;(function f(){var t=r[u++];if(!t)return a();t.on("end",f);o?o.add(t):e.emit("entry",t)})();return o}}(e.pipe)}module.exports=collect;