var tap=require("tap"),test=tap.test,semver=require("../semver.js"),eq=semver.eq,gt=semver.gt,lt=semver.lt,neq=semver.neq,cmp=semver.cmp,gte=semver.gte,lte=semver.lte,satisfies=semver.satisfies,validRange=semver.validRange,inc=semver.inc,replaceStars=semver.replaceStars,toComparators=semver.toComparators,SemVer=semver.SemVer,Range=semver.Range;test("\ncomparison tests",function(e){[["0.0.0","0.0.0-foo"],["0.0.1","0.0.0"],["1.0.0","0.9.9"],["0.10.0","0.9.0"],["0.99.0","0.10.0"],["2.0.0","1.2.3"],["v0.0.0","0.0.0-foo",!0],["v0.0.1","0.0.0",!0],["v1.0.0","0.9.9",!0],["v0.10.0","0.9.0",!0],["v0.99.0","0.10.0",!0],["v2.0.0","1.2.3",!0],["0.0.0","v0.0.0-foo",!0],["0.0.1","v0.0.0",!0],["1.0.0","v0.9.9",!0],["0.10.0","v0.9.0",!0],["0.99.0","v0.10.0",!0],["2.0.0","v1.2.3",!0],["1.2.3","1.2.3-asdf"],["1.2.3","1.2.3-4"],["1.2.3","1.2.3-4-foo"],["1.2.3-5-foo","1.2.3-5"],["1.2.3-5","1.2.3-4"],["1.2.3-5-foo","1.2.3-5-Foo"],["3.0.0","2.7.2+asdf"],["1.2.3-a.10","1.2.3-a.5"],["1.2.3-a.b","1.2.3-a.5"],["1.2.3-a.b","1.2.3-a"],["1.2.3-a.b.c.10.d.5","1.2.3-a.b.c.5.d.100"]].forEach(function(n){var r=n[0],i=n[1],s=n[2];e.ok(gt(r,i,s),"gt('"+r+"', '"+i+"')");e.ok(lt(i,r,s),"lt('"+i+"', '"+r+"')");e.ok(!gt(i,r,s),"!gt('"+i+"', '"+r+"')");e.ok(!lt(r,i,s),"!lt('"+r+"', '"+i+"')");e.ok(eq(r,r,s),"eq('"+r+"', '"+r+"')");e.ok(eq(i,i,s),"eq('"+i+"', '"+i+"')");e.ok(neq(r,i,s),"neq('"+r+"', '"+i+"')");e.ok(cmp(i,"==",i,s),"cmp('"+i+"' == '"+i+"')");e.ok(cmp(r,">=",i,s),"cmp('"+r+"' >= '"+i+"')");e.ok(cmp(i,"<=",r,s),"cmp('"+i+"' <= '"+r+"')");e.ok(cmp(r,"!=",i,s),"cmp('"+r+"' != '"+i+"')")});e.end()});test("\nequality tests",function(e){[["1.2.3","v1.2.3",!0],["1.2.3","=1.2.3",!0],["1.2.3","v 1.2.3",!0],["1.2.3","= 1.2.3",!0],["1.2.3"," v1.2.3",!0],["1.2.3"," =1.2.3",!0],["1.2.3"," v 1.2.3",!0],["1.2.3"," = 1.2.3",!0],["1.2.3-0","v1.2.3-0",!0],["1.2.3-0","=1.2.3-0",!0],["1.2.3-0","v 1.2.3-0",!0],["1.2.3-0","= 1.2.3-0",!0],["1.2.3-0"," v1.2.3-0",!0],["1.2.3-0"," =1.2.3-0",!0],["1.2.3-0"," v 1.2.3-0",!0],["1.2.3-0"," = 1.2.3-0",!0],["1.2.3-1","v1.2.3-1",!0],["1.2.3-1","=1.2.3-1",!0],["1.2.3-1","v 1.2.3-1",!0],["1.2.3-1","= 1.2.3-1",!0],["1.2.3-1"," v1.2.3-1",!0],["1.2.3-1"," =1.2.3-1",!0],["1.2.3-1"," v 1.2.3-1",!0],["1.2.3-1"," = 1.2.3-1",!0],["1.2.3-beta","v1.2.3-beta",!0],["1.2.3-beta","=1.2.3-beta",!0],["1.2.3-beta","v 1.2.3-beta",!0],["1.2.3-beta","= 1.2.3-beta",!0],["1.2.3-beta"," v1.2.3-beta",!0],["1.2.3-beta"," =1.2.3-beta",!0],["1.2.3-beta"," v 1.2.3-beta",!0],["1.2.3-beta"," = 1.2.3-beta",!0],["1.2.3-beta+build"," = 1.2.3-beta+otherbuild",!0],["1.2.3+build"," = 1.2.3+otherbuild",!0],["1.2.3-beta+build","1.2.3-beta+otherbuild"],["1.2.3+build","1.2.3+otherbuild"],["  v1.2.3+build","1.2.3+otherbuild"]].forEach(function(n){var r=n[0],i=n[1],s=n[2];e.ok(eq(r,i,s),"eq('"+r+"', '"+i+"')");e.ok(!neq(r,i,s),"!neq('"+r+"', '"+i+"')");e.ok(cmp(r,"==",i,s),"cmp("+r+"=="+i+")");e.ok(!cmp(r,"!=",i,s),"!cmp("+r+"!="+i+")");e.ok(!cmp(r,"===",i,s),"!cmp("+r+"==="+i+")");e.ok(cmp(r,"!==",i,s),"cmp("+r+"!=="+i+")");e.ok(!gt(r,i,s),"!gt('"+r+"', '"+i+"')");e.ok(gte(r,i,s),"gte('"+r+"', '"+i+"')");e.ok(!lt(r,i,s),"!lt('"+r+"', '"+i+"')");e.ok(lte(r,i,s),"lte('"+r+"', '"+i+"')")});e.end()});test("\nrange tests",function(e){[["1.0.0 - 2.0.0","1.2.3"],["1.0.0","1.0.0"],[">=*","0.2.4"],["","1.0.0"],["*","1.2.3"],["*","v1.2.3-foo",!0],[">=1.0.0","1.0.0"],[">=1.0.0","1.0.1"],[">=1.0.0","1.1.0"],[">1.0.0","1.0.1"],[">1.0.0","1.1.0"],["<=2.0.0","2.0.0"],["<=2.0.0","1.9999.9999"],["<=2.0.0","0.2.9"],["<2.0.0","1.9999.9999"],["<2.0.0","0.2.9"],[">= 1.0.0","1.0.0"],[">=  1.0.0","1.0.1"],[">=   1.0.0","1.1.0"],["> 1.0.0","1.0.1"],[">  1.0.0","1.1.0"],["<=   2.0.0","2.0.0"],["<= 2.0.0","1.9999.9999"],["<=  2.0.0","0.2.9"],["<    2.0.0","1.9999.9999"],["<	2.0.0","0.2.9"],[">=0.1.97","v0.1.97",!0],[">=0.1.97","0.1.97"],["0.1.20 || 1.2.4","1.2.4"],[">=0.2.3 || <0.0.1","0.0.0"],[">=0.2.3 || <0.0.1","0.2.3"],[">=0.2.3 || <0.0.1","0.2.4"],["||","1.3.4"],["2.x.x","2.1.3"],["1.2.x","1.2.3"],["1.2.x || 2.x","2.1.3"],["1.2.x || 2.x","1.2.3"],["x","1.2.3"],["2.*.*","2.1.3"],["1.2.*","1.2.3"],["1.2.* || 2.*","2.1.3"],["1.2.* || 2.*","1.2.3"],["*","1.2.3"],["2","2.1.2"],["2.3","2.3.1"],["~2.4","2.4.0"],["~2.4","2.4.5"],["~>3.2.1","3.2.2"],["~1","1.2.3"],["~>1","1.2.3"],["~> 1","1.2.3"],["~1.0","1.0.2"],["~ 1.0","1.0.2"],["~ 1.0.3","1.0.12"],[">=1","1.0.0"],[">= 1","1.0.0"],["<1.2","1.1.1"],["< 1.2","1.1.1"],["1","1.0.0beta",!0],["~v0.5.4-pre","0.5.5"],["~v0.5.4-pre","0.5.4"],["=0.7.x","0.7.2"],[">=0.7.x","0.7.2"],["=0.7.x","0.7.0-asdf"],[">=0.7.x","0.7.0-asdf"],["<=0.7.x","0.6.2"],["~1.2.1 >=1.2.3","1.2.3"],["~1.2.1 =1.2.3","1.2.3"],["~1.2.1 1.2.3","1.2.3"],["~1.2.1 >=1.2.3 1.2.3","1.2.3"],["~1.2.1 1.2.3 >=1.2.3","1.2.3"],["~1.2.1 1.2.3","1.2.3"],[">=1.2.1 1.2.3","1.2.3"],["1.2.3 >=1.2.1","1.2.3"],[">=1.2.3 >=1.2.1","1.2.3"],[">=1.2.1 >=1.2.3","1.2.3"],["<=1.2.3","1.2.3-beta"],[">1.2","1.3.0-beta"],[">=1.2","1.2.8"],["^1.2.3","1.8.1"],["^1.2.3","1.2.3-beta"],["^0.1.2","0.1.2"],["^0.1","0.1.2"],["^1.2","1.4.2"],["^1.2 ^1","1.4.2"],["^1.2","1.2.0-pre"],["^1.2.3","1.2.3-pre"]].forEach(function(n){var r=n[0],i=n[1],s=n[2];e.ok(satisfies(i,r,s),r+" satisfied by "+i)});e.end()});test("\nnegative range tests",function(e){[["1.0.0 - 2.0.0","2.2.3"],["1.0.0","1.0.1"],[">=1.0.0","0.0.0"],[">=1.0.0","0.0.1"],[">=1.0.0","0.1.0"],[">1.0.0","0.0.1"],[">1.0.0","0.1.0"],["<=2.0.0","3.0.0"],["<=2.0.0","2.9999.9999"],["<=2.0.0","2.2.9"],["<2.0.0","2.9999.9999"],["<2.0.0","2.2.9"],[">=0.1.97","v0.1.93",!0],[">=0.1.97","0.1.93"],["0.1.20 || 1.2.4","1.2.3"],[">=0.2.3 || <0.0.1","0.0.3"],[">=0.2.3 || <0.0.1","0.2.2"],["2.x.x","1.1.3"],["2.x.x","3.1.3"],["1.2.x","1.3.3"],["1.2.x || 2.x","3.1.3"],["1.2.x || 2.x","1.1.3"],["2.*.*","1.1.3"],["2.*.*","3.1.3"],["1.2.*","1.3.3"],["1.2.* || 2.*","3.1.3"],["1.2.* || 2.*","1.1.3"],["2","1.1.2"],["2.3","2.4.1"],["~2.4","2.5.0"],["~2.4","2.3.9"],["~>3.2.1","3.3.2"],["~>3.2.1","3.2.0"],["~1","0.2.3"],["~>1","2.2.3"],["~1.0","1.1.0"],["<1","1.0.0"],[">=1.2","1.1.1"],["1","2.0.0beta",!0],["~v0.5.4-beta","0.5.4-alpha"],["<1","1.0.0beta",!0],["< 1","1.0.0beta",!0],["=0.7.x","0.8.2"],[">=0.7.x","0.6.2"],["<=0.7.x","0.7.2"],["<1.2.3","1.2.3-beta"],["=1.2.3","1.2.3-beta"],[">1.2","1.2.8"],["^1.2.3","2.0.0-alpha"],["^1.2.3","1.2.2"],["^1.2","1.1.9"],["blerg","1.2.3"],["git+https://user:password0123@github.com/foo","123.0.0",!0],["^1.2.3","2.0.0-pre"]].forEach(function(n){var r=n[0],i=n[1],s=n[2],o=satisfies(i,r,s);e.ok(!o,i+" not satisfied by "+r)});e.end()});test("\nincrement versions test",function(e){[["1.2.3","major","2.0.0"],["1.2.3","minor","1.3.0"],["1.2.3","patch","1.2.4"],["1.2.3tag","major","2.0.0",!0],["1.2.3-tag","major","2.0.0"],["1.2.3","fake",null],["fake","major",null],["1.2.3","prerelease","1.2.3-0"],["1.2.3-0","prerelease","1.2.3-1"],["1.2.3-alpha.0","prerelease","1.2.3-alpha.1"],["1.2.3-alpha.1","prerelease","1.2.3-alpha.2"],["1.2.3-alpha.2","prerelease","1.2.3-alpha.3"],["1.2.3-alpha.0.beta","prerelease","1.2.3-alpha.1.beta"],["1.2.3-alpha.1.beta","prerelease","1.2.3-alpha.2.beta"],["1.2.3-alpha.2.beta","prerelease","1.2.3-alpha.3.beta"],["1.2.3-alpha.10.0.beta","prerelease","1.2.3-alpha.10.1.beta"],["1.2.3-alpha.10.1.beta","prerelease","1.2.3-alpha.10.2.beta"],["1.2.3-alpha.10.2.beta","prerelease","1.2.3-alpha.10.3.beta"],["1.2.3-alpha.10.beta.0","prerelease","1.2.3-alpha.10.beta.1"],["1.2.3-alpha.10.beta.1","prerelease","1.2.3-alpha.10.beta.2"],["1.2.3-alpha.10.beta.2","prerelease","1.2.3-alpha.10.beta.3"],["1.2.3-alpha.9.beta","prerelease","1.2.3-alpha.10.beta"],["1.2.3-alpha.10.beta","prerelease","1.2.3-alpha.11.beta"],["1.2.3-alpha.11.beta","prerelease","1.2.3-alpha.12.beta"]].forEach(function(n){var r=n[0],i=n[1],s=n[2],o=n[3],u=inc(r,i,o);e.equal(u,s,"inc("+r+", "+i+") === "+s)});e.end()});test("\nvalid range test",function(e){[["1.0.0 - 2.0.0",">=1.0.0 <=2.0.0"],["1.0.0","1.0.0"],[">=*",">=0.0.0-0"],["","*"],["*","*"],["*","*"],[">=1.0.0",">=1.0.0"],[">1.0.0",">1.0.0"],["<=2.0.0","<=2.0.0"],["1",">=1.0.0-0 <2.0.0-0"],["<=2.0.0","<=2.0.0"],["<=2.0.0","<=2.0.0"],["<2.0.0","<2.0.0-0"],["<2.0.0","<2.0.0-0"],[">= 1.0.0",">=1.0.0"],[">=  1.0.0",">=1.0.0"],[">=   1.0.0",">=1.0.0"],["> 1.0.0",">1.0.0"],[">  1.0.0",">1.0.0"],["<=   2.0.0","<=2.0.0"],["<= 2.0.0","<=2.0.0"],["<=  2.0.0","<=2.0.0"],["<    2.0.0","<2.0.0-0"],["<	2.0.0","<2.0.0-0"],[">=0.1.97",">=0.1.97"],[">=0.1.97",">=0.1.97"],["0.1.20 || 1.2.4","0.1.20||1.2.4"],[">=0.2.3 || <0.0.1",">=0.2.3||<0.0.1-0"],[">=0.2.3 || <0.0.1",">=0.2.3||<0.0.1-0"],[">=0.2.3 || <0.0.1",">=0.2.3||<0.0.1-0"],["||","||"],["2.x.x",">=2.0.0-0 <3.0.0-0"],["1.2.x",">=1.2.0-0 <1.3.0-0"],["1.2.x || 2.x",">=1.2.0-0 <1.3.0-0||>=2.0.0-0 <3.0.0-0"],["1.2.x || 2.x",">=1.2.0-0 <1.3.0-0||>=2.0.0-0 <3.0.0-0"],["x","*"],["2.*.*",">=2.0.0-0 <3.0.0-0"],["1.2.*",">=1.2.0-0 <1.3.0-0"],["1.2.* || 2.*",">=1.2.0-0 <1.3.0-0||>=2.0.0-0 <3.0.0-0"],["*","*"],["2",">=2.0.0-0 <3.0.0-0"],["2.3",">=2.3.0-0 <2.4.0-0"],["~2.4",">=2.4.0-0 <2.5.0-0"],["~2.4",">=2.4.0-0 <2.5.0-0"],["~>3.2.1",">=3.2.1-0 <3.3.0-0"],["~1",">=1.0.0-0 <2.0.0-0"],["~>1",">=1.0.0-0 <2.0.0-0"],["~> 1",">=1.0.0-0 <2.0.0-0"],["~1.0",">=1.0.0-0 <1.1.0-0"],["~ 1.0",">=1.0.0-0 <1.1.0-0"],["^0",">=0.0.0-0 <1.0.0-0"],["^ 1",">=1.0.0-0 <2.0.0-0"],["^0.1",">=0.1.0-0 <0.2.0-0"],["^1.0",">=1.0.0-0 <2.0.0-0"],["^1.2",">=1.2.0-0 <2.0.0-0"],["^0.0.1","=0.0.1"],["^0.0.1-beta","=0.0.1-beta"],["^0.1.2",">=0.1.2-0 <0.2.0-0"],["^1.2.3",">=1.2.3-0 <2.0.0-0"],["^1.2.3-beta.4",">=1.2.3-beta.4 <2.0.0-0"],["<1","<1.0.0-0"],["< 1","<1.0.0-0"],[">=1",">=1.0.0-0"],[">= 1",">=1.0.0-0"],["<1.2","<1.2.0-0"],["< 1.2","<1.2.0-0"],["1",">=1.0.0-0 <2.0.0-0"],[">01.02.03",">1.2.3",!0],[">01.02.03",null],["~1.2.3beta",">=1.2.3-beta <1.3.0-0",!0],["~1.2.3beta",null],["^ 1.2 ^ 1",">=1.2.0-0 <2.0.0-0 >=1.0.0-0 <2.0.0-0"]].forEach(function(n){var r=n[0],i=n[1],s=n[2],o=validRange(r,s);e.equal(o,i,"validRange("+r+") === "+i)});e.end()});test("\ncomparators test",function(e){[["1.0.0 - 2.0.0",[[">=1.0.0","<=2.0.0"]]],["1.0.0",[["1.0.0"]]],[">=*",[[">=0.0.0-0"]]],["",[[""]]],["*",[[""]]],["*",[[""]]],[">=1.0.0",[[">=1.0.0"]]],[">=1.0.0",[[">=1.0.0"]]],[">=1.0.0",[[">=1.0.0"]]],[">1.0.0",[[">1.0.0"]]],[">1.0.0",[[">1.0.0"]]],["<=2.0.0",[["<=2.0.0"]]],["1",[[">=1.0.0-0","<2.0.0-0"]]],["<=2.0.0",[["<=2.0.0"]]],["<=2.0.0",[["<=2.0.0"]]],["<2.0.0",[["<2.0.0-0"]]],["<2.0.0",[["<2.0.0-0"]]],[">= 1.0.0",[[">=1.0.0"]]],[">=  1.0.0",[[">=1.0.0"]]],[">=   1.0.0",[[">=1.0.0"]]],["> 1.0.0",[[">1.0.0"]]],[">  1.0.0",[[">1.0.0"]]],["<=   2.0.0",[["<=2.0.0"]]],["<= 2.0.0",[["<=2.0.0"]]],["<=  2.0.0",[["<=2.0.0"]]],["<    2.0.0",[["<2.0.0-0"]]],["<	2.0.0",[["<2.0.0-0"]]],[">=0.1.97",[[">=0.1.97"]]],[">=0.1.97",[[">=0.1.97"]]],["0.1.20 || 1.2.4",[["0.1.20"],["1.2.4"]]],[">=0.2.3 || <0.0.1",[[">=0.2.3"],["<0.0.1-0"]]],[">=0.2.3 || <0.0.1",[[">=0.2.3"],["<0.0.1-0"]]],[">=0.2.3 || <0.0.1",[[">=0.2.3"],["<0.0.1-0"]]],["||",[[""],[""]]],["2.x.x",[[">=2.0.0-0","<3.0.0-0"]]],["1.2.x",[[">=1.2.0-0","<1.3.0-0"]]],["1.2.x || 2.x",[[">=1.2.0-0","<1.3.0-0"],[">=2.0.0-0","<3.0.0-0"]]],["1.2.x || 2.x",[[">=1.2.0-0","<1.3.0-0"],[">=2.0.0-0","<3.0.0-0"]]],["x",[[""]]],["2.*.*",[[">=2.0.0-0","<3.0.0-0"]]],["1.2.*",[[">=1.2.0-0","<1.3.0-0"]]],["1.2.* || 2.*",[[">=1.2.0-0","<1.3.0-0"],[">=2.0.0-0","<3.0.0-0"]]],["1.2.* || 2.*",[[">=1.2.0-0","<1.3.0-0"],[">=2.0.0-0","<3.0.0-0"]]],["*",[[""]]],["2",[[">=2.0.0-0","<3.0.0-0"]]],["2.3",[[">=2.3.0-0","<2.4.0-0"]]],["~2.4",[[">=2.4.0-0","<2.5.0-0"]]],["~2.4",[[">=2.4.0-0","<2.5.0-0"]]],["~>3.2.1",[[">=3.2.1-0","<3.3.0-0"]]],["~1",[[">=1.0.0-0","<2.0.0-0"]]],["~>1",[[">=1.0.0-0","<2.0.0-0"]]],["~> 1",[[">=1.0.0-0","<2.0.0-0"]]],["~1.0",[[">=1.0.0-0","<1.1.0-0"]]],["~ 1.0",[[">=1.0.0-0","<1.1.0-0"]]],["~ 1.0.3",[[">=1.0.3-0","<1.1.0-0"]]],["~> 1.0.3",[[">=1.0.3-0","<1.1.0-0"]]],["<1",[["<1.0.0-0"]]],["< 1",[["<1.0.0-0"]]],[">=1",[[">=1.0.0-0"]]],[">= 1",[[">=1.0.0-0"]]],["<1.2",[["<1.2.0-0"]]],["< 1.2",[["<1.2.0-0"]]],["1",[[">=1.0.0-0","<2.0.0-0"]]],["1 2",[[">=1.0.0-0","<2.0.0-0",">=2.0.0-0","<3.0.0-0"]]],["1.2 - 3.4.5",[[">=1.2.0-0","<=3.4.5"]]],["1.2.3 - 3.4",[[">=1.2.3","<3.5.0-0"]]]].forEach(function(n){var r=n[0],i=n[1],s=toComparators(n[0]),o=JSON.stringify(i);e.equivalent(s,i,"toComparators("+r+") === "+o)});e.end()});test("\nstrict vs loose version numbers",function(e){[["=1.2.3","1.2.3"],["01.02.03","1.2.3"],["1.2.3-beta.01","1.2.3-beta.1"],["   =1.2.3","1.2.3"],["1.2.3foo","1.2.3-foo"]].forEach(function(n){var r=n[0],i=n[1];e.throws(function(){new SemVer(r)});var s=new SemVer(r,!0);e.equal(s.version,i);e.ok(eq(r,i,!0));e.throws(function(){eq(r,i)});e.throws(function(){(new SemVer(i)).compare(r)})});e.end()});test("\nstrict vs loose ranges",function(e){[[">=01.02.03",">=1.2.3"],["~1.02.03beta",">=1.2.3-beta <1.3.0-0"]].forEach(function(n){var r=n[0],i=n[1];e.throws(function(){new Range(r)});e.equal((new Range(r,!0)).range,i)});e.end()});test("\nmax satisfying",function(e){[[["1.2.3","1.2.4"],"1.2","1.2.4"],[["1.2.4","1.2.3"],"1.2","1.2.4"],[["1.2.3","1.2.4","1.2.5","1.2.6"],"~1.2.3","1.2.6"],[["1.1.0","1.2.0","1.2.1","1.3.0","2.0.0b1","2.0.0b2","2.0.0b3","2.0.0","2.1.0"],"~2.0.0","2.0.0",!0]].forEach(function(n){var r=n[0],i=n[1],s=n[2],o=n[3],u=semver.maxSatisfying(r,i,o);e.equal(u,s)});e.end()});