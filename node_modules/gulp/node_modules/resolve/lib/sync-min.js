var core=require("./core"),fs=require("fs"),path=require("path"),caller=require("./caller.js"),nodeModulesPaths=require("./node-modules-paths.js");module.exports=function(e,t){function a(e){if(n(e))return e;for(var t=0;t<i.length;t++){var r=e+i[t];if(n(r))return r}}function f(e){var i=path.join(e,"/package.json");if(n(i)){var s=r(i,"utf8");try{var o=JSON.parse(s);t.packageFilter&&(o=t.packageFilter(o,e));if(o.main){var u=a(path.resolve(e,o.main));if(u)return u;var l=f(path.resolve(e,o.main));if(l)return l}}catch(c){}}return a(path.join(e,"/index"))}function l(e,n){var r=nodeModulesPaths(n,t);for(var i=0;i<r.length;i++){var s=r[i],o=a(path.join(s,"/",e));if(o)return o;var u=f(path.join(s,"/",e));if(u)return u}}t||(t={});var n=t.isFile||function(e){try{var t=fs.statSync(e)}catch(n){if(n&&n.code==="ENOENT")return!1}return t.isFile()||t.isFIFO()},r=t.readFileSync||fs.readFileSync,i=t.extensions||[".js"],s=t.basedir||path.dirname(caller());t.paths=t.paths||[];if(e.match(/^(?:\.\.?\/|\/|([A-Za-z]:)?\\)/)){var o=a(path.resolve(s,e))||f(path.resolve(s,e));if(o)return o}else{var u=l(e,s);if(u)return u}if(core[e])return e;throw new Error("Cannot find module '"+e+"' from '"+s+"'")};