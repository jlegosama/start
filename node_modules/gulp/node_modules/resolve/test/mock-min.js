var test=require("tap").test,resolve=require("../");test("mock",function(e){function n(e){return{basedir:e,isFile:function(e,n){n(null,t.hasOwnProperty(e))},readFile:function(e,n){n(null,t[e])}}}e.plan(6);var t={"/foo/bar/baz.js":"beep"};resolve("./baz",n("/foo/bar"),function(t,n,r){t&&e.fail(t);e.equal(n,"/foo/bar/baz.js");e.equal(r,undefined)});resolve("./baz.js",n("/foo/bar"),function(t,n,r){t&&e.fail(t);e.equal(n,"/foo/bar/baz.js");e.equal(r,undefined)});resolve("baz",n("/foo/bar"),function(t,n){e.equal(t.message,"Cannot find module 'baz' from '/foo/bar'")});resolve("../baz",n("/foo/bar"),function(t,n){e.equal(t.message,"Cannot find module '../baz' from '/foo/bar'")})});test("mock from package",function(e){function n(e){return{basedir:e,"package":{main:"bar"},isFile:function(e,n){n(null,t.hasOwnProperty(e))},readFile:function(e,n){n(null,t[e])}}}e.plan(6);var t={"/foo/bar/baz.js":"beep"};resolve("./baz",n("/foo/bar"),function(t,n,r){t&&e.fail(t);e.equal(n,"/foo/bar/baz.js");e.equal(r.main,"bar")});resolve("./baz.js",n("/foo/bar"),function(t,n,r){t&&e.fail(t);e.equal(n,"/foo/bar/baz.js");e.equal(r.main,"bar")});resolve("baz",n("/foo/bar"),function(t,n){e.equal(t.message,"Cannot find module 'baz' from '/foo/bar'")});resolve("../baz",n("/foo/bar"),function(t,n){e.equal(t.message,"Cannot find module '../baz' from '/foo/bar'")})});test("mock package",function(e){function n(e){return{basedir:e,isFile:function(e,n){n(null,t.hasOwnProperty(e))},readFile:function(e,n){n(null,t[e])}}}e.plan(2);var t={"/foo/node_modules/bar/baz.js":"beep","/foo/node_modules/bar/package.json":JSON.stringify({main:"./baz.js"})};resolve("bar",n("/foo"),function(t,n,r){t&&e.fail(t);e.equal(n,"/foo/node_modules/bar/baz.js");e.equal(r.main,"./baz.js")})});test("mock package from package",function(e){function n(e){return{basedir:e,"package":{main:"bar"},isFile:function(e,n){n(null,t.hasOwnProperty(e))},readFile:function(e,n){n(null,t[e])}}}e.plan(2);var t={"/foo/node_modules/bar/baz.js":"beep","/foo/node_modules/bar/package.json":JSON.stringify({main:"./baz.js"})};resolve("bar",n("/foo"),function(t,n,r){t&&e.fail(t);e.equal(n,"/foo/node_modules/bar/baz.js");e.equal(r.main,"./baz.js")})});