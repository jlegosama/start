var assert=require("chai").assert,stream=require("stream"),duplexer2=require("../");describe("duplexer2",function(){var e,t;beforeEach(function(){e=new stream.Writable({objectMode:!0});t=new stream.Readable({objectMode:!0});e._write=function(t,n,r){return r()};t._read=function(t){}});it("should interact with the writable stream properly for writing",function(n){var r=duplexer2(e,t);e._write=function(t,r,i){assert.strictEqual(t,"well hello there");return n()};r.write("well hello there")});it("should interact with the readable stream properly for reading",function(n){var r=duplexer2(e,t);r.on("data",function(e){assert.strictEqual(e,"well hello there");return n()});t.push("well hello there")});it("should end the writable stream, causing it to finish",function(n){var r=duplexer2(e,t);e.once("finish",n);r.end()});it("should finish when the writable stream finishes",function(n){var r=duplexer2(e,t);r.once("finish",n);e.end()});it("should end when the readable stream ends",function(n){var r=duplexer2(e,t);r.resume();r.once("end",n);t.push(null)});it("should bubble errors from the writable stream when no behaviour is specified",function(n){var r=duplexer2(e,t),i=Error("testing");r.on("error",function(e){assert.strictEqual(e,i);return n()});e.emit("error",i)});it("should bubble errors from the readable stream when no behaviour is specified",function(n){var r=duplexer2(e,t),i=Error("testing");r.on("error",function(e){assert.strictEqual(e,i);return n()});t.emit("error",i)});it("should bubble errors from the writable stream when bubbleErrors is true",function(n){var r=duplexer2({bubbleErrors:!0},e,t),i=Error("testing");r.on("error",function(e){assert.strictEqual(e,i);return n()});e.emit("error",i)});it("should bubble errors from the readable stream when bubbleErrors is true",function(n){var r=duplexer2({bubbleErrors:!0},e,t),i=Error("testing");r.on("error",function(e){assert.strictEqual(e,i);return n()});t.emit("error",i)});it("should not bubble errors from the writable stream when bubbleErrors is false",function(n){var r=duplexer2({bubbleErrors:!1},e,t),i=setTimeout(n,25);r.on("error",function(e){clearTimeout(i);return n(Error("shouldn't bubble error"))});e.on("error",function(){});e.emit("error",Error("testing"))});it("should not bubble errors from the readable stream when bubbleErrors is false",function(n){var r=duplexer2({bubbleErrors:!1},e,t),i=setTimeout(n,25);r.on("error",function(e){clearTimeout(i);return n(Error("shouldn't bubble error"))});t.on("error",function(){});t.emit("error",Error("testing"))})});