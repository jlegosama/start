function BufferList(e){if(!(this instanceof BufferList))return new BufferList(e);this._bufs=[];this.length=0;if(typeof e=="function"){this._callback=e;var t=function(e){if(this._callback){this._callback(e);this._callback=null}}.bind(this);this.on("pipe",function(e){e.on("error",t)});this.on("unpipe",function(e){e.removeListener("error",t)})}else Buffer.isBuffer(e)?this.append(e):Array.isArray(e)&&e.forEach(function(e){Buffer.isBuffer(e)&&this.append(e)}.bind(this));DuplexStream.call(this)}const DuplexStream=require("stream").DuplexStream||require("readable-stream/duplex"),util=require("util");util.inherits(BufferList,DuplexStream);BufferList.prototype._offset=function(e){var t=0,n=0,r;for(;n<this._bufs.length;n++){r=t+this._bufs[n].length;if(e<r)return[n,e-t];t=r}};BufferList.prototype.append=function(e){this._bufs.push(Buffer.isBuffer(e)?e:new Buffer(e));this.length+=e.length;return this};BufferList.prototype._write=function(e,t,n){this.append(e);n&&n()};BufferList.prototype._read=function(e){if(!this.length)return this.push(null);e=Math.min(e,this.length);this.push(this.slice(0,e));this.consume(e)};BufferList.prototype.end=function(e){DuplexStream.prototype.end.call(this,e);if(this._callback){this._callback(null,this.slice());this._callback=null}};BufferList.prototype.get=function(e){return this.slice(e,e+1)[0]};BufferList.prototype.slice=function(e,t){return this.copy(null,0,e,t)};BufferList.prototype.copy=function(e,t,n,r){if(typeof n!="number"||n<0)n=0;if(typeof r!="number"||r>this.length)r=this.length;if(n>=this.length)return e||new Buffer(0);if(r<=0)return e||new Buffer(0);var i=!!e,s=this._offset(n),o=r-n,u=o,a=i&&t||0,f=s[1],l,c;if(n===0&&r==this.length){if(!i)return Buffer.concat(this._bufs);for(c=0;c<this._bufs.length;c++){this._bufs[c].copy(e,a);a+=this._bufs[c].length}return e}if(u<=this._bufs[s[0]].length-f)return i?this._bufs[s[0]].copy(e,t,f,f+u):this._bufs[s[0]].slice(f,f+u);i||(e=new Buffer(o));for(c=s[0];c<this._bufs.length;c++){l=this._bufs[c].length-f;if(!(u>l)){this._bufs[c].copy(e,a,f,f+u);break}this._bufs[c].copy(e,a,f);a+=l;u-=l;f&&(f=0)}return e};BufferList.prototype.toString=function(e,t,n){return this.slice(t,n).toString(e)};BufferList.prototype.consume=function(e){while(this._bufs.length){if(!(e>this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(e);this.length-=e;break}e-=this._bufs[0].length;this.length-=this._bufs[0].length;this._bufs.shift()}return this};BufferList.prototype.duplicate=function(){var e=0,t=new BufferList;for(;e<this._bufs.length;e++)t.append(this._bufs[e]);return t};(function(){var e={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1};Object.keys(e).forEach(function(t){BufferList.prototype[t]=function(n){return this.slice(n,n+e[t])[t](0)}})})();module.exports=BufferList;