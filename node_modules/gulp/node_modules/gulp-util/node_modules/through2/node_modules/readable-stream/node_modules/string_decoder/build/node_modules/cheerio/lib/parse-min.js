/*
  Module Dependencies
*/var htmlparser=require("htmlparser2"),_=require("underscore"),isTag=require("./utils").isTag,camelCase=require("./utils").camelCase;exports=module.exports=function(e,t){var n=evaluate(e,t),r={type:"root",name:"root",parent:null,prev:null,next:null,children:[]};update(n,r);return r};var evaluate=exports.evaluate=function(e,t){var n=new htmlparser.DomHandler(t),r=new htmlparser.Parser(n,t);r.write(e);r.done();_.forEach(n.dom,parseData);return n.dom},update=exports.update=function(e,t){Array.isArray(e)||(e=[e]);t?t.children=e:t=null;for(var n=0;n<e.length;n++){var r=e[n],i=r.parent&&r.parent.children;if(i&&i!==e){i.splice(i.indexOf(r),1);r.prev&&(r.prev.next=r.next);r.next&&(r.next.prev=r.prev)}r.prev=e[n-1]||null;r.next=e[n+1]||null;if(t&&t.type==="root"){r.root=t;r.parent=null}else{delete r.root;r.parent=t}}return t},parseData=exports.parseData=function(e){e.data===undefined&&(e.data={});var t;for(var n in e.attribs)if(n.substr(0,5)==="data-"){t=e.attribs[n];n=n.slice(5);n=camelCase(n);e.data[n]=t}_.forEach(e.children,parseData)};