function bind(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){var r=n.concat(Array.prototype.slice.call(arguments));return t.apply(e,r)}}function hyperquest(e,t,n,r){if(typeof e=="object"){n=t;t=e;e=undefined}if(typeof t=="function"){n=t;t=undefined}t||(t={});e!==undefined&&(t.uri=e);r&&(t.method=r.method);var i=new Req(t),s=i.duplex&&through();s&&s.pause();var o=through(),u=i.duplex?duplexer(s,o):o;i.duplex||(o.writable=!1);u.request=i;u.setHeader=bind(i,i.setHeader);u.setLocation=bind(i,i.setLocation);var a=!1;u.on("close",function(){a=!0});process.nextTick(function(){if(a)return;u.on("close",function(){e.destroy()});var e=i._send();e.on("error",bind(u,u.emit,"error"));e.on("response",function(e){u.response=e;u.emit("response",e);if(i.duplex)e.pipe(o);else{e.on("data",function(e){o.queue(e)});e.on("end",function(){o.queue(null)})}});if(i.duplex){s.pipe(e);s.resume()}else e.end()});if(n){u.on("error",n);u.on("response",bind(u,n,null))}return u}function Req(e){this.headers=e.headers||{};var t=(e.method||"GET").toUpperCase();this.method=t;this.duplex=t!=="GET"&&t!=="DELETE"&&t!=="HEAD";this.auth=e.auth;e.uri&&this.setLocation(e.uri)}var url=require("url"),http=require("http"),https=require("https"),through=require("through"),duplexer=require("duplexer");module.exports=hyperquest;hyperquest.get=hyperquest;hyperquest.post=function(e,t,n){return hyperquest(e,t,n,{method:"POST"})};hyperquest.put=function(e,t,n){return hyperquest(e,t,n,{method:"PUT"})};hyperquest["delete"]=function(e,t,n){return hyperquest(e,t,n,{method:"DELETE"})};Req.prototype._send=function(){this._sent=!0;var e=this.headers||{},t=url.parse(this.uri),n=t.auth||this.auth;n&&(e.authorization="Basic "+Buffer(n).toString("base64"));var r=t.protocol||"",i=r==="https:"?https:http,s=i.request({scheme:r.replace(/:$/,""),method:this.method,host:t.hostname,port:Number(t.port),path:t.path,agent:!1,headers:e});s.setTimeout&&s.setTimeout(Math.pow(2,32)*1e3);return s};Req.prototype.setHeader=function(e,t){if(this._sent)throw new Error("request already sent");this.headers[e]=t;return this};Req.prototype.setLocation=function(e){this.uri=e;return this};