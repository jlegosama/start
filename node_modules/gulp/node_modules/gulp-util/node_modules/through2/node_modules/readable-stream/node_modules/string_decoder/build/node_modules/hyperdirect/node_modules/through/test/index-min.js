function write(e,t){function n(){while(e.length)if(t.write(e.shift())===!1)return t.once("drain",n);t.end()}e=e.slice();n()}function read(e,t){var n=[];e.on("data",function(e){n.push(e)});e.once("end",function(){t(null,n)});e.once("error",function(e){t(e)})}var test=require("tape"),spec=require("stream-spec"),through=require("../");test("simple defaults",function(e){var t=1e3,n=[];while(t--)n.push(t*Math.random());var r=through();spec(r).through().pausable().validateOnExit();read(r,function(t,r){e.ifError(t);e.deepEqual(r,n);e.end()});write(n,r)});test("simple functions",function(e){var t=1e3,n=[];while(t--)n.push(t*Math.random());var r=through(function(e){this.emit("data",e*2)});spec(r).through().pausable().validateOnExit();read(r,function(t,r){e.ifError(t);e.deepEqual(r,n.map(function(e){return e*2}));e.end()});write(n,r)});test("pauses",function(e){var t=1e3,n=[];while(t--)n.push(t);var r=through();spec(r).through().pausable().validateOnExit();r.on("data",function(){if(Math.random()>.1)return;r.pause();process.nextTick(function(){r.resume()})});read(r,function(t,r){e.ifError(t);e.deepEqual(r,n);e.end()});write(n,r)});