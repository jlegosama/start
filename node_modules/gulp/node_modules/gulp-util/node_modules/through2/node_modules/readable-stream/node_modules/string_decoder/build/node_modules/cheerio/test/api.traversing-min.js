var expect=require("expect.js"),$=require("../"),food=require("./fixtures").food,fruits=require("./fixtures").fruits,drinks=require("./fixtures").drinks,text=require("./fixtures").text;describe("$(...)",function(){describe(".find",function(){it("() : should find nothing",function(){expect($("ul",fruits).find()).to.have.length(0)});it("(single) : should find one descendant",function(){expect($("#fruits",fruits).find(".apple")[0].attribs["class"]).to.equal("apple")});it("(many) : should find all matching descendant",function(){expect($("#fruits",fruits).find("li")).to.have.length(3)});it("(many) : should merge all selected elems with matching descendants",function(){expect($("#fruits, #food",food).find(".apple")).to.have.length(1)});it("(invalid single) : should return empty if cant find",function(){expect($("ul",fruits).find("blah")).to.have.length(0)});it("(invalid single) : should query descendants only",function(){expect($("#fruits",fruits).find("ul")).to.have.length(0)});it("should return empty if search already empty result",function(){expect($("#fruits").find("li")).to.have.length(0)});it("should throw a SyntaxError if given an invalid selector",function(){expect(function(){$("#fruits").find(":bah")}).to.throwException(function(e){expect(e).to.be.a(SyntaxError)})})});describe(".children",function(){it("() : should get all children",function(){expect($("ul",fruits).children()).to.have.length(3)});it("() : should return children of all matched elements",function(){expect($("ul ul",food).children()).to.have.length(5)});it("(selector) : should return children matching selector",function(){var e=$("ul",fruits).children(".orange")[0].attribs["class"];expect(e).to.equal("orange")});it("(invalid selector) : should return empty",function(){expect($("ul",fruits).children(".lulz")).to.have.length(0)});it("should only match immediate children, not ancestors",function(){expect($(food).children("li")).to.have.length(0)})});describe(".contents",function(){it("() : should get all contents",function(){expect($("p",text).contents()).to.have.length(5)});it("() : should include text nodes",function(){expect($("p",text).contents().first()[0].type).to.equal("text")});it("() : should include comment nodes",function(){expect($("p",text).contents().last()[0].type).to.equal("comment")})});describe(".next",function(){it("() : should return next element",function(){var e=$(".orange",fruits).next()[0].attribs["class"];expect(e).to.equal("pear")});it("(no next) : should return empty for last child",function(){expect($(".pear",fruits).next()).to.have.length(0)});it("(next on empty object) : should return empty",function(){expect($(".banana",fruits).next()).to.have.length(0)});it("() : should operate over all elements in the selection",function(){expect($(".apple, .orange",food).next()).to.have.length(2)})});describe(".nextAll",function(){it("() : should return all following siblings",function(){var e=$(".apple",fruits).nextAll();expect(e).to.have.length(2);expect(e[0].attribs["class"]).to.equal("orange");expect(e[1].attribs["class"]).to.equal("pear")});it("(no next) : should return empty for last child",function(){expect($(".pear",fruits).nextAll()).to.have.length(0)});it("(nextAll on empty object) : should return empty",function(){expect($(".banana",fruits).nextAll()).to.have.length(0)});it("() : should operate over all elements in the selection",function(){expect($(".apple, .carrot",food).nextAll()).to.have.length(3)});it("() : should not contain duplicate elements",function(){var e=$(".apple, .orange",food);expect(e.nextAll()).to.have.length(2)})});describe(".nextUntil",function(){it("() : should return all following siblings if no selector specified",function(){var e=$(".apple",food).nextUntil();expect(e).to.have.length(2);expect(e[0].attribs["class"]).to.equal("orange");expect(e[1].attribs["class"]).to.equal("pear")});it("() : should filter out non-element nodes",function(){var e=$("<div><div></div><!-- comment -->text<div></div></div>"),t=e.children().eq(0);expect(t.nextUntil()).to.have.length(1)});it("() : should operate over all elements in the selection",function(){var e=$(".apple, .carrot",food);expect(e.nextUntil()).to.have.length(3)});it("() : should not contain duplicate elements",function(){var e=$(".apple, .orange",food);expect(e.nextUntil()).to.have.length(2)});it("(selector) : should return all following siblings until selector",function(){var e=$(".apple",food).nextUntil(".pear");expect(e).to.have.length(1);expect(e[0].attribs["class"]).to.equal("orange")});it("(selector not sibling) : should return all following siblings",function(){var e=$(".apple",fruits).nextUntil("#vegetables");expect(e).to.have.length(2)});it("(selector, filterString) : should return all following siblings until selector, filtered by filter",function(){var e=$(".beer",drinks).nextUntil(".water",".milk");expect(e).to.have.length(1);expect(e[0].attribs["class"]).to.equal("milk")});it("() : should return an empty object for last child",function(){expect($(".pear",fruits).nextUntil()).to.have.length(0)});it("() : should return an empty object when called on an empty object",function(){expect($(".banana",fruits).nextUntil()).to.have.length(0)});it("(node) : should return all following siblings until the node",function(){var e=$(fruits).children(),t=e.eq(0).nextUntil(e[2]);expect(t).to.have.length(1)});it("(cheerio object) : should return all following siblings until any member of the cheerio object",function(){var e=$(drinks).children(),t=$([e[4],e[3]]),n=e.eq(0).nextUntil(t);expect(n).to.have.length(2)})});describe(".prev",function(){it("() : should return previous element",function(){var e=$(".orange",fruits).prev()[0].attribs["class"];expect(e).to.equal("apple")});it("(no prev) : should return empty for first child",function(){expect($(".apple",fruits).prev()).to.have.length(0)});it("(prev on empty object) : should return empty",function(){expect($(".banana",fruits).prev()).to.have.length(0)});it("() : should operate over all elements in the selection",function(){expect($(".orange, .pear",food).prev()).to.have.length(2)})});describe(".prevAll",function(){it("() : should return all preceding siblings",function(){var e=$(".pear",fruits).prevAll();expect(e).to.have.length(2);expect(e[0].attribs["class"]).to.equal("orange");expect(e[1].attribs["class"]).to.equal("apple")});it("(no prev) : should return empty for first child",function(){expect($(".apple",fruits).prevAll()).to.have.length(0)});it("(prevAll on empty object) : should return empty",function(){expect($(".banana",fruits).prevAll()).to.have.length(0)});it("() : should operate over all elements in the selection",function(){expect($(".orange, .sweetcorn",food).prevAll()).to.have.length(2)});it("() : should not contain duplicate elements",function(){var e=$(".orange, .pear",food);expect(e.prevAll()).to.have.length(2)})});describe(".prevUntil",function(){it("() : should return all preceding siblings if no selector specified",function(){var e=$(".pear",fruits).prevUntil();expect(e).to.have.length(2);expect(e[0].attribs["class"]).to.equal("orange");expect(e[1].attribs["class"]).to.equal("apple")});it("() : should filter out non-element nodes",function(){var e=$('<div class="1"><div class="2"></div><!-- comment -->text<div class="3"></div></div>'),t=e.children().last();expect(t.prevUntil()).to.have.length(1)});it("() : should operate over all elements in the selection",function(){var e=$(".pear, .sweetcorn",food);expect(e.prevUntil()).to.have.length(3)});it("() : should not contain duplicate elements",function(){var e=$(".orange, .pear",food);expect(e.prevUntil()).to.have.length(2)});it("(selector) : should return all preceding siblings until selector",function(){var e=$(".pear",fruits).prevUntil(".apple");expect(e).to.have.length(1);expect(e[0].attribs["class"]).to.equal("orange")});it("(selector not sibling) : should return all preceding siblings",function(){var e=$(".sweetcorn",food).prevUntil("#fruits");expect(e).to.have.length(1);expect(e[0].attribs["class"]).to.equal("carrot")});it("(selector, filterString) : should return all preceding siblings until selector, filtered by filter",function(){var e=$(".cider",drinks).prevUntil(".juice",".water");expect(e).to.have.length(1);expect(e[0].attribs["class"]).to.equal("water")});it("() : should return an empty object for first child",function(){expect($(".apple",fruits).prevUntil()).to.have.length(0)});it("() : should return an empty object when called on an empty object",function(){expect($(".banana",fruits).prevUntil()).to.have.length(0)});it("(node) : should return all previous siblings until the node",function(){var e=$(fruits).children(),t=e.eq(2).prevUntil(e[0]);expect(t).to.have.length(1)});it("(cheerio object) : should return all previous siblings until any member of the cheerio object",function(){var e=$(drinks).children(),t=$([e[0],e[1]]),n=e.eq(4).prevUntil(t);expect(n).to.have.length(2)})});describe(".siblings",function(){it("() : should get all the siblings",function(){expect($(".orange",fruits).siblings()).to.have.length(2);expect($("#fruits",fruits).siblings()).to.have.length(0);expect($(".apple, .carrot",food).siblings()).to.have.length(3)});it("(selector) : should get all siblings that match the selector",function(){expect($(".orange",fruits).siblings(".apple")).to.have.length(1);expect($(".orange",fruits).siblings(".peach")).to.have.length(0)});it("(selector) : should throw a SyntaxError if given an invalid selector",function(){expect(function(){$(".orange",fruits).siblings(":bah")}).to.throwException(function(e){expect(e).to.be.a(SyntaxError)})})});describe(".parents",function(){it("() : should get all of the parents in logical order",function(){var e=$(".orange",food).parents();expect(e).to.have.length(2);expect(e[0].attribs.id).to.be("fruits");expect(e[1].attribs.id).to.be("food");e=$("#fruits",food).parents();expect(e).to.have.length(1);expect(e[0].attribs.id).to.be("food")});it("(selector) : should get all of the parents that match the selector in logical order",function(){var e=$(".orange",food).parents("#fruits");expect(e).to.have.length(1);expect(e[0].attribs.id).to.be("fruits");e=$(".orange",food).parents("ul");expect(e).to.have.length(2);expect(e[0].attribs.id).to.be("fruits");expect(e[1].attribs.id).to.be("food")});it("() : should not break if the selector does not have any results",function(){var e=$(".saladbar",food).parents();expect(e).to.have.length(0)});it("() : should return an empty set for top-level elements",function(){var e=$("#food",food).parents();expect(e).to.have.length(0)});it("() : should return the parents of every element in the *reveresed* collection, omitting duplicates",function(){var e=$(food),t=e.find("li").parents();expect(t).to.have.length(3);expect(t[0]).to.be(e.find("#vegetables")[0]);expect(t[1]).to.be(e[0]);expect(t[2]).to.be(e.find("#fruits")[0])})});describe(".parent",function(){it("() : should return the parent of each matched element",function(){var e=$(".orange",fruits).parent();expect(e).to.have.length(1);expect(e[0].attribs.id).to.be("fruits");e=$("li",food).parent();expect(e).to.have.length(2);expect(e[0].attribs.id).to.be("fruits");expect(e[1].attribs.id).to.be("vegetables")});it("() : should return an empty object for top-level elements",function(){var e=$("ul",fruits).parent();expect(e).to.have.length(0)});it("() : should not contain duplicate elements",function(){var e=$("li",fruits).parent();expect(e).to.have.length(1)});it("(selector) : should filter the matched parent elements by the selector",function(){var e=$(".orange",fruits).parent();expect(e).to.have.length(1);expect(e[0].attribs.id).to.be("fruits");e=$("li",food).parent("#fruits");expect(e).to.have.length(1);expect(e[0].attribs.id).to.be("fruits")})});describe(".closest",function(){it("() : should return an empty array",function(){var e=$(".orange",fruits).closest();expect(e).to.have.length(0);expect(e).to.be.a($)});it("(selector) : should find the closest element that matches the selector, searching through its ancestors and itself",function(){expect($(".orange",fruits).closest(".apple")).to.have.length(0);var e=$(".orange",food).closest("#food");expect(e[0].attribs.id).to.be("food");e=$(".orange",food).closest("ul");expect(e[0].attribs.id).to.be("fruits");e=$(".orange",food).closest("li");expect(e[0].attribs["class"]).to.be("orange")});it("(selector) : should find the closest element of each item, removing duplicates",function(){var e=$("li",food).closest("ul");expect(e).to.have.length(2)});it("() : should not break if the selector does not have any results",function(){var e=$(".saladbar",food).closest("ul");expect(e).to.have.length(0)})});describe(".each",function(){it("( (i, elem) -> ) : should loop selected returning fn with (i, elem)",function(){var e=[],t=["apple","orange","pear"];$("li",fruits).each(function(n,r){e[n]=r;expect(this[0].attribs["class"]).to.equal(t[n])});expect(e[0].attribs["class"]).to.equal("apple");expect(e[1].attribs["class"]).to.equal("orange");expect(e[2].attribs["class"]).to.equal("pear")});it("( (i, elem) -> ) : should break iteration when the iterator function returns false",function(){var e=0;$("li",fruits).each(function(t,n){e++;return t<1});expect(e).to.equal(2)})});describe(".map",function(){it("(fn) : should be invoked with the correct arguments and context",function(){var e=$("li",fruits),t=[],n=[];e.map(function(){t.push(arguments);n.push(this)});expect(t).to.eql([[0,e[0]],[1,e[1]],[2,e[2]]]);expect(n).to.eql([e[0],e[1],e[2]])});it("(fn) : should return an Cheerio object wrapping the returned items",function(){var e=$("li",fruits),t=e.map(function(t,n){return e[2-t]});expect(t).to.have.length(3);expect(t[0]).to.be(e[2]);expect(t[1]).to.be(e[1]);expect(t[2]).to.be(e[0])});it("(fn) : should ignore `null` and `undefined` returned by iterator",function(){var e=$("li",fruits),t=[null,undefined,e[1]],n=e.map(function(e,n){return t[e]});expect(n).to.have.length(1);expect(n[0]).to.be(e[1])});it("(fn) : should preform a shallow merge on arrays returned by iterator",function(){var e=$("li",fruits),t=e.map(function(e,t){return[1,[3,4]]});expect(t.toArray()).to.eql([1,[3,4],1,[3,4],1,[3,4]])});it("(fn) : should tolerate `null` and `undefined` when flattening arrays returned by iterator",function(){var e=$("li",fruits),t=e.map(function(e,t){return[null,undefined]});expect(t.toArray()).to.eql([null,undefined,null,undefined,null,undefined])})});describe(".filter",function(){it("(selector) : should reduce the set of matched elements to those that match the selector",function(){var e=$("li",fruits).filter(".pear").text();expect(e).to.be("Pear")});it("(selector) : should not consider nested elements",function(){var e=$(fruits).filter("li");expect(e).to.have.length(0)});it("(selection) : should reduce the set of matched elements to those that are contained in the provided selection",function(){var e=$("li",fruits),t=e.filter(".pear, .apple");expect(e.filter(t)).to.have.length(2)});it("(element) : should reduce the set of matched elements to those that specified directly",function(){var e=$("li",fruits),t=e.filter(".pear")[0];expect(e.filter(t)).to.have.length(1)});it("(fn) : should reduce the set of matched elements to those that pass the function's test",function(){var e=$("li",fruits).filter(function(e,t){expect(this[0]).to.be(t);expect(t.name).to.be("li");expect(e).to.be.a("number");return this.attr("class")==="orange"}).text();expect(e).to.be("Orange")})});describe(".first",function(){it("() : should return the first item",function(){var e=$("<span>foo</span><span>bar</span><span>baz</span>"),t=e.first();expect(t.length).to.equal(1);expect(t[0].children[0].data).to.equal("foo")});it("() : should return an empty object for an empty object",function(){var e=$(),t=e.first();expect(t.length).to.equal(0);expect(t[0]).to.be(undefined)})});describe(".last",function(){it("() : should return the last element",function(){var e=$("<span>foo</span><span>bar</span><span>baz</span>"),t=e.last();expect(t.length).to.equal(1);expect(t[0].children[0].data).to.equal("baz")});it("() : should return an empty object for an empty object",function(){var e=$(),t=e.last();expect(t.length).to.equal(0);expect(t[0]).to.be(undefined)})});describe(".first & .last",function(){it("() : should return equivalent collections if only one element",function(){var e=$("<span>bar</span>"),t=e.first(),n=e.last();expect(t.length).to.equal(1);expect(t[0].children[0].data).to.equal("bar");expect(n.length).to.equal(1);expect(n[0].children[0].data).to.equal("bar");expect(t[0]).to.equal(n[0])})});describe(".eq",function(){function e(e){return e.length?e[0].children[0].data:""}it("(i) : should return the element at the specified index",function(){expect(e($("li",fruits).eq(0))).to.equal("Apple");expect(e($("li",fruits).eq(1))).to.equal("Orange");expect(e($("li",fruits).eq(2))).to.equal("Pear");expect(e($("li",fruits).eq(3))).to.equal("");expect(e($("li",fruits).eq(-1))).to.equal("Pear")})});describe(".slice",function(){function e(e){return e.length?e[0].children[0].data:""}it("(start) : should return all elements after the given index",function(){var t=$("li",fruits).slice(1);expect(t).to.have.length(2);expect(e(t.eq(0))).to.equal("Orange");expect(e(t.eq(1))).to.equal("Pear")});it("(start, end) : should return all elements matching the given range",function(){var t=$("li",fruits).slice(1,2);expect(t).to.have.length(1);expect(e(t.eq(0))).to.equal("Orange")});it("(-start) : should return element matching the offset from the end",function(){var t=$("li",fruits).slice(-1);expect(t).to.have.length(1);expect(e(t.eq(0))).to.equal("Pear")})});describe(".end() :",function(){var e=$(fruits).children();it("returns an empty object at the end of the chain",function(){expect(e.end().end()).to.be.ok();expect(e.end().end()).to.have.length(0)});it("find",function(){expect(e.find(".apple").end()).to.be(e)});it("filter",function(){expect(e.filter(".apple").end()).to.be(e)});it("map",function(){expect(e.map(function(){return this}).end()).to.be(e)});it("contents",function(){expect(e.contents().end()).to.be(e)});it("eq",function(){expect(e.eq(1).end()).to.be(e)});it("first",function(){expect(e.first().end()).to.be(e)});it("last",function(){expect(e.last().end()).to.be(e)});it("slice",function(){expect(e.slice(1).end()).to.be(e)});it("children",function(){expect(e.children().end()).to.be(e)});it("parent",function(){expect(e.parent().end()).to.be(e)});it("parents",function(){expect(e.parents().end()).to.be(e)});it("closest",function(){expect(e.closest("ul").end()).to.be(e)});it("siblings",function(){expect(e.siblings().end()).to.be(e)});it("next",function(){expect(e.next().end()).to.be(e)});it("nextAll",function(){expect(e.nextAll().end()).to.be(e)});it("prev",function(){expect(e.prev().end()).to.be(e)});it("prevAll",function(){expect(e.prevAll().end()).to.be(e)});it("clone",function(){expect(e.clone().end()).to.be(e)})})});