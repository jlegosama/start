var test=require("tape"),through=require("../");test("buffering",function(e){var t=through(function(e){this.queue(e)},function(){this.queue(null)}),n=!1,r=[];t.on("data",r.push.bind(r));t.on("end",function(){n=!0});t.write(1);t.write(2);t.write(3);e.deepEqual(r,[1,2,3]);t.pause();t.write(4);t.write(5);t.write(6);e.deepEqual(r,[1,2,3]);t.resume();e.deepEqual(r,[1,2,3,4,5,6]);t.pause();t.end();e.ok(!n);t.resume();e.ok(n);e.end()});test("buffering has data in queue, when ends",function(e){var t=through(function(e){this.queue(e)},function(){this.queue(null)}),n=!1,r=[];t.on("data",r.push.bind(r));t.on("end",function(){n=!0});t.pause();t.write(1);t.write(2);t.write(3);t.end();e.deepEqual(r,[],"no data written yet, still paused");e.ok(!n,"end not emitted yet, still paused");t.resume();e.deepEqual(r,[1,2,3],"resumed, all data should be delivered");e.ok(n,"end should be emitted once all data was delivered");e.end()});