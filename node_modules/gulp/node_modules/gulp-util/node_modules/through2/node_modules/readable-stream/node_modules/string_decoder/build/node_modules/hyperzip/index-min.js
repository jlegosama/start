function zip(e){function t(e,t,n){if(typeof e=="object"){n=t;t=e;e=undefined}if(typeof t=="function"){n=t;t=undefined}t||(t={});e!==undefined&&(t.uri=e);t.headers=t.headers||{};t.headers["Accept-Encoding"]=t.headers["Accept-Encoding"]?t.headers["Accept-Encoding"]+",gzip,deflate":"gzip,deflate";var r=(t.method||"GET").toUpperCase(),i=r!="GET"&&r!="DELETE",s=through(),o=hyperquest(t,function(e,t){e&&u.emit("error",e);switch(t.headers["content-encoding"]){case"gzip":t.headers["content-encoding"]=null;this.pipe(zlib.createGunzip()).pipe(s);break;case"deflate":t.headers["content-encoding"]=null;this.pipe(zlib.createInflate()).pipe(s);break;default:this.pipe(s)}u.emit("response",t)}),u=i?duplexer(o,s):s;if(n){u.on("error",n);u.on("response",function(e){n.call(u,null,e)})}return u}e===undefined&&(e=hyperquest);typeof e.request=="function"&&(e=e.request);if(e.isCap)throw new Error('The subquest argument "'+e+'" was invalid.  You must use a valid hyperquest module that is not a cap.');t.request=t;return t}var through=require("through"),duplexer=require("duplexer"),zlib=require("zlib"),hyperquest=require("hyperquest");module.exports=zip;module.exports.request=zip(hyperquest);