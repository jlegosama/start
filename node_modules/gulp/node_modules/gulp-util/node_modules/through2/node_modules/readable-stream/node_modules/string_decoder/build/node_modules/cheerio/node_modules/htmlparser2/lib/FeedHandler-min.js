function FeedHandler(e,t){this.init(e,t)}function getElements(e,t){return DomUtils.getElementsByTagName(e,t,!0)}function getOneElement(e,t){return DomUtils.getElementsByTagName(e,t,!0,1)[0]}function fetch(e,t,n){return DomUtils.getText(DomUtils.getElementsByTagName(e,t,n,1)).trim()}function addConditionally(e,t,n,r,i){var s=fetch(n,r,i);s&&(e[t]=s)}var index=require("./index.js"),DomHandler=index.DomHandler,DomUtils=index.DomUtils;require("util").inherits(FeedHandler,DomHandler);FeedHandler.prototype.init=DomHandler;var isValidFeed=function(e){return e==="rss"||e==="feed"||e==="rdf:RDF"};FeedHandler.prototype.onend=function(){var e={},t=getOneElement(isValidFeed,this.dom),n,r;if(t)if(t.name==="feed"){r=t.children;e.type="atom";addConditionally(e,"id","id",r);addConditionally(e,"title","title",r);(n=getOneElement("link",r))&&(n=n.attribs)&&(n=n.href)&&(e.link=n);addConditionally(e,"description","subtitle",r);if(n=fetch("updated",r))e.updated=new Date(n);addConditionally(e,"author","email",r,!0);e.items=getElements("entry",r).map(function(e){var t={},n;e=e.children;addConditionally(t,"id","id",e);addConditionally(t,"title","title",e);(n=getOneElement("link",e))&&(n=n.attribs)&&(n=n.href)&&(t.link=n);addConditionally(t,"description","summary",e);if(n=fetch("updated",e))t.pubDate=new Date(n);return t})}else{r=getOneElement("channel",t.children).children;e.type=t.name.substr(0,3);e.id="";addConditionally(e,"title","title",r);addConditionally(e,"link","link",r);addConditionally(e,"description","description",r);if(n=fetch("lastBuildDate",r))e.updated=new Date(n);addConditionally(e,"author","managingEditor",r,!0);e.items=getElements("item",t.children).map(function(e){var t={},n;e=e.children;addConditionally(t,"id","guid",e);addConditionally(t,"title","title",e);addConditionally(t,"link","link",e);addConditionally(t,"description","description",e);if(n=fetch("pubDate",e))t.pubDate=new Date(n);return t})}this.dom=e;DomHandler.prototype._handleCallback.call(this,t?null:Error("couldn't find root of feed"))};module.exports=FeedHandler;