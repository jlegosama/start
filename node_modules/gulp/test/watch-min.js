"use strict";var gulp=require("../"),fs=require("graceful-fs"),rimraf=require("rimraf"),mkdirp=require("mkdirp"),path=require("path"),should=require("should");require("mocha");var outpath=path.join(__dirname,"./out-fixtures");describe("gulp",function(){describe("watch()",function(){beforeEach(rimraf.bind(null,outpath));beforeEach(mkdirp.bind(null,outpath));afterEach(rimraf.bind(null,outpath));var e="A test generated this file and it is safe to delete",t=125,n=function(e,n,r){r||(r=function(){});setTimeout(function(){fs.writeFile(e,n,r)},t)};it("should call the function when file changes: no options",function(t){var r=path.join(outpath,"watch-func.txt");fs.writeFile(r,e,function(){var i=gulp.watch(r,function(e){should.exist(e);should.exist(e.path);should.exist(e.type);e.type.should.equal("changed");e.path.should.equal(path.resolve(r));i.end();t()});n(r,e+" changed")})});it("should call the function when file changes: w/ options",function(t){var r=path.join(outpath,"watch-func-options.txt");fs.writeFile(r,e,function(){var i=gulp.watch(r,{debounceDelay:5},function(e){should.exist(e);should.exist(e.path);should.exist(e.type);e.type.should.equal("changed");e.path.should.equal(path.resolve(r));i.end();t()});n(r,e+" changed")})});it("should run many tasks: w/ options",function(r){var i=path.join(outpath,"watch-task-options.txt"),s="task1",o="task2",u="task3",a=0,f=t*2.5;fs.writeFile(i,e,function(){gulp.task(s,function(){a++});gulp.task(o,function(){a+=10});gulp.task(u,function(){throw new Error("task3 called!")});setTimeout(function(){a.should.equal(11);gulp.reset();t.end();r()},f);var t=gulp.watch(i,{debounceDelay:f/2},[s,o]);n(i,e+" changed")})})})});